{"version":3,"sources":["webpack:///./node_modules/mcanvas/dist/mcanvas.es.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","_defineProperty","key","value","Object","defineProperty","enumerable","configurable","writable","_objectSpread","target","i","arguments","length","source","ownKeys","keys","getOwnPropertySymbols","concat","filter","sym","getOwnPropertyDescriptor","forEach","_slicedToArray","arr","_arrayWithHoles","_iterableToArrayLimit","_nonIterableRest","Array","isArray","_arr","_n","_d","_e","undefined","_s","_i","next","done","push","err","TypeError","_","extend","obj1","obj2","_this","this","type","isType","forin","k","v","vType","loadImage","image","loaded","error","img","Image","indexOf","crossOrigin","onload","setTimeout","onerror","src","isObject","tar","isObjFunc","isBoolean","isArr","getImage","cbk","console","log","hasOwnProperty","isIos8","UA","window","navigator","userAgent","toLowerCase","IOS","test","IPAD","match","deepCopy","JSON","parse","stringify","name","toString","call","split","replace","getSize","iw","ih","tagName","naturalWidth","naturalHeight","width","height","offsetWidth","offsetHeight","MCanvas","options","ops","backgroundColor","canvas","ctx","queue","fn","success","data","textId","text","bgConfig","_init","document","createElement","getContext","save","setBgColor","background","bg","color","_background","fillStyle","fillRect","_getBgAlign","left","cw","cropScale","rv","Math","abs","sx","sy","swidth","sheight","dx","dy","dwidth","dheight","_$getSize","iRatio","cRatio","top","drawImage","_next","rect","_this2","_ops$fillColor","fillColor","_ops$strokeColor","strokeColor","_ops$strokeWidth","strokeWidth","ch","_get","x","y","lineWidth","strokeStyle","beginPath","strokeRect","closePath","_resetCtx","circle","_this3","_ops$fillColor2","_ops$strokeColor2","_ops$strokeWidth2","r","arc","PI","fill","stroke","setTransform","restore","watermark","_ops$width","_ops$pos","pos","_ops$margin","margin","position","scale","rotate","add","_this4","def","crop","_add","_handleOps","warn","cdx","cdy","cdw","cdh","ldx","ldy","ldw","ldh","spaceX","spaceY","shrink","_$getSize2","_ops$crop","lsx","lsy","lsw","lsh","cratio","lcvs","lctx","_ratio","lctxScale","round","_map","map","_map2","translate","maxLsw","maxLsh","_$getSize3","ratio","_ops$crop2","cropx","cropy","cropw","croph","_ops$pos2","px","py","pr","ps","parseFloat","_this5","context","fontFamily","size","defaultStyle","shadow","blur","offsetX","offsetY","option","align","smallStyle","font","lineHeight","normalStyle","largeStyle","maxFont","parseContext","_parse","max","maxFontSize","parseInt","_text","result","splitTag","tmp","textArr","_this6","style","line","getLineHeight","measureText","fontLength","tdw","tdh","tcvs","tctx","tdx","tdy","_getTextRectHeight","_fillText","originX","originY","vlh","lh","textAlign","textBaseline","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","gradient","x1","y1","x2","y2","_style$gradient","colorStop","grad","createLinearGradient","colorNum","addColorStop","lastLine","lastLineData","par","child","str","draw","b64","_this7","_ops","quality","toDataURL","shift","clear","clearRect","getPos","imgW","cropW","getLength","MCrop","_ops$success","_ops$error","minL","min","_ops$type","cvs","_x","_y","globalCompositeOperation","exportConfig","MCrop$1"],"mappings":"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","file":"js/chunk-2d2132c0.31b58923.js","sourcesContent":["function _typeof(obj) {\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function (obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function (obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    var ownKeys = Object.keys(source);\n\n    if (typeof Object.getOwnPropertySymbols === 'function') {\n      ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n      }));\n    }\n\n    ownKeys.forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    });\n  }\n\n  return target;\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest();\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n}\n\nvar _ = {\n  extend: function extend(obj1, obj2) {\n    var _this = this;\n\n    var type = this.isType(obj2);\n\n    if (type === 'object') {\n      this.forin(obj2, function (k, v) {\n        var vType = _this.isType(v);\n\n        if (vType !== 'object' && vType !== 'array') {\n          obj1[k] = v;\n        } else {\n          if (_this.isType(obj1[k]) !== vType || obj1[k] === null) {\n            obj1[k] = vType === 'object' ? {} : [];\n          }\n\n          _this.extend(obj1[k], v);\n        }\n      });\n    } else if (type === 'array') {\n      for (var i = 0; i < obj2.length; i++) {\n        obj1[i] = obj2[i];\n      }\n    } else {\n      obj1 = obj2;\n    }\n\n    return obj1;\n  },\n  loadImage: function loadImage(image, loaded, error) {\n    var img = new Image();\n\n    if (image.indexOf('http') === 0) {\n      img.crossOrigin = '*';\n    }\n\n    img.onload = function () {\n      loaded(img);\n      setTimeout(function () {\n        return img = null;\n      }, 1000);\n    };\n\n    img.onerror = function () {\n      error('img load error');\n    };\n\n    img.src = image;\n  },\n  isObject: function isObject(tar) {\n    return this.isObjFunc(tar, 'Object');\n  },\n  isBoolean: function isBoolean(tar) {\n    return this.isObjFunc(tar, 'Boolean');\n  },\n  isArr: function isArr(tar) {\n    return this.isObjFunc(tar, 'Array');\n  },\n  getImage: function getImage(image, cbk, error) {\n    if (typeof image === 'string') {\n      this.loadImage(image, function (img) {\n        cbk(img);\n      }, error);\n    } else if (_typeof(image) === 'object') {\n      cbk(image);\n    } else {\n      console.log('add image error');\n      return;\n    }\n  },\n  forin: function forin(obj, cbk) {\n    for (var k in obj) {\n      if (obj.hasOwnProperty(k)) {\n        cbk(k, obj[k]);\n      }\n    }\n  },\n  isIos8: function isIos8() {\n    var UA = window.navigator.userAgent.toLowerCase();\n    var IOS = /(iPhone|iPad|iPod|iOS)/gi.test(UA);\n    var IPAD = /(iPad)/gi.test(UA);\n\n    if (IOS) {\n      return IPAD ? UA.match(/cpu os (\\d*)/)[1] < 9 : UA.match(/iphone os (\\d*)/)[1] < 9;\n    } else {\n      return false;\n    }\n  },\n  deepCopy: function deepCopy(obj) {\n    return JSON.parse(JSON.stringify(obj));\n  },\n  isObjFunc: function isObjFunc(tar, name) {\n    return Object.prototype.toString.call(tar) === '[object ' + name + ']';\n  },\n  isType: function isType(tar) {\n    return Object.prototype.toString.call(tar).split(' ')[1].replace(']', '').toLowerCase();\n  },\n  getSize: function getSize(img) {\n    var iw, ih;\n\n    if (img.tagName === 'IMG') {\n      iw = img.naturalWidth;\n      ih = img.naturalHeight;\n    } else if (img.tagName === 'CANVAS') {\n      iw = img.width;\n      ih = img.height;\n    } else {\n      iw = img.offsetWidth;\n      ih = img.offsetHeight;\n    }\n\n    return {\n      iw: iw,\n      ih: ih\n    };\n  }\n};\n\nfunction MCanvas() {\n  var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  // 兼容不使用 new 的方式；\n  if (!(this instanceof MCanvas)) return new MCanvas(options); // 配置canvas初始大小；\n  // width：画布宽度，Number,选填，默认为 500;\n  // height: 画布高度，Number，选填，默认与宽度一致；\n\n  this.ops = _.extend({\n    width: 500,\n    height: 500,\n    backgroundColor: ''\n  }, options); // 全局画布；\n\n  this.canvas = null;\n  this.ctx = null; // 绘制函数队列；\n\n  this.queue = []; // 回调函数池；\n\n  this.fn = {\n    // 最后执行的函数；\n    success: function success() {},\n    // 错误回调；\n    error: function error() {}\n  };\n  this.data = {\n    // 文字id；\n    textId: 0,\n    // 文字绘制数据；\n    text: {},\n    // 背景图数据;\n    bgConfig: null // 初始化创建画布；\n\n  };\n\n  this._init();\n}\n\nMCanvas.prototype._init = function () {\n  this.canvas = document.createElement('canvas');\n  this.canvas.width = this.ops.width;\n  this.canvas.height = this.ops.height;\n  this.ctx = this.canvas.getContext('2d');\n  this.ctx.save();\n  this.ops.backgroundColor && this.setBgColor(this.ops.backgroundColor);\n}; // --------------------------------------------------------\n// 绘制背景部分；\n// --------------------------------------------------------\n\n\nMCanvas.prototype.background = function (image) {\n  var _this = this;\n\n  var bg = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {\n    type: 'origin'\n  };\n\n  if (!image && !this.data.bgConfig) {\n    console.error('mcanvas error : the init background must has a image.');\n    return;\n  } // 缓存bg options， 用于重置；\n\n\n  if (!image) {\n    bg = this.data.bgConfig;\n  } else {\n    bg.image = image;\n    this.data.bgConfig = bg;\n  }\n\n  this.queue.push(function () {\n    if (bg.color) _this.setBgColor(bg.color);\n\n    _.getImage(bg.image, function (img) {\n      _this._background(img, bg);\n    }, _this.fn.error);\n  });\n  return this;\n}; // 设置画布颜色;\n\n\nMCanvas.prototype.setBgColor = function (color) {\n  this.ctx.fillStyle = color;\n  this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\n};\n\nMCanvas.prototype._getBgAlign = function (left, iw, cw, cropScale) {\n  var rv;\n\n  if (typeof left === 'string') {\n    if (left === '50%' || left === 'center') {\n      rv = Math.abs((iw - cw / cropScale) / 2);\n    } else if (left === '100%') {\n      rv = Math.abs(iw - cw / cropScale);\n    } else if (left === '0%') {\n      rv = 0;\n    }\n  } else if (typeof left === 'number') {\n    rv = left;\n  } else {\n    rv = 0;\n  }\n\n  return rv;\n};\n\nMCanvas.prototype._background = function (img, bg) {\n  var _$getSize = _.getSize(img),\n      iw = _$getSize.iw,\n      ih = _$getSize.ih; // 图片与canvas的长宽比；\n\n\n  var iRatio = iw / ih;\n  var cRatio = this.canvas.width / this.canvas.height; // 背景绘制参数；\n\n  var sx, sy, swidth, sheight, dx, dy, dwidth, dheight;\n  var cropScale;\n\n  switch (bg.type) {\n    // 裁剪模式，固定canvas大小，原图铺满，超出的部分裁剪；\n    case 'crop':\n      if (iRatio > cRatio) {\n        swidth = ih * cRatio;\n        sheight = ih;\n        cropScale = this.canvas.height / ih;\n      } else {\n        swidth = iw;\n        sheight = swidth / cRatio;\n        cropScale = this.canvas.width / iw;\n      }\n\n      sx = this._getBgAlign(bg.left, iw, this.canvas.width, cropScale);\n      sy = this._getBgAlign(bg.top, ih, this.canvas.height, cropScale);\n      dy = dx = 0;\n      dheight = this.canvas.height;\n      dwidth = this.canvas.width;\n      break;\n    // 包含模式，固定canvas大小，包含背景图；\n\n    case 'contain':\n      sy = sx = 0;\n      swidth = iw;\n      sheight = ih;\n\n      if (iRatio > cRatio) {\n        dwidth = this.canvas.width;\n        dheight = dwidth / iRatio;\n        dx = bg.left || 0;\n        dy = bg.top || bg.top === 0 ? bg.top : (this.canvas.height - dheight) / 2;\n      } else {\n        dheight = this.canvas.height;\n        dwidth = dheight * iRatio;\n        dy = bg.top || 0;\n        dx = bg.left || bg.left === 0 ? bg.left : (this.canvas.width - dwidth) / 2;\n      }\n\n      break;\n    // 原图模式：canvas与原图大小一致，忽略初始化 传入的宽高参数；\n    // 同时，background 传入的 left/top 均被忽略；\n\n    case 'origin':\n      this.canvas.width = iw;\n      this.canvas.height = ih;\n      sx = sy = 0;\n      swidth = iw;\n      sheight = ih;\n      dx = dy = 0;\n      dwidth = this.canvas.width;\n      dheight = this.canvas.height;\n      break;\n\n    default:\n      console.error('mcanvas error:background type error!');\n      return;\n  }\n\n  this.ctx.drawImage(img, sx, sy, swidth, sheight, dx, dy, dwidth, dheight);\n\n  this._next();\n}; // --------------------------------------------------------\n// 绘制图层部分；\n// --------------------------------------------------------\n// 绘制矩形层；\n\n\nMCanvas.prototype.rect = function (ops) {\n  var _this2 = this;\n\n  this.queue.push(function () {\n    var _ops$fillColor = ops.fillColor,\n        fillColor = _ops$fillColor === void 0 ? '#fff' : _ops$fillColor,\n        _ops$strokeColor = ops.strokeColor,\n        strokeColor = _ops$strokeColor === void 0 ? fillColor : _ops$strokeColor,\n        _ops$strokeWidth = ops.strokeWidth,\n        strokeWidth = _ops$strokeWidth === void 0 ? 0 : _ops$strokeWidth;\n    var cw = _this2.canvas.width,\n        ch = _this2.canvas.height;\n    var width = _this2._get(cw, 0, ops.width || 0, 'pos') - 2 * strokeWidth,\n        height = _this2._get(ch, 0, ops.height || 0, 'pos') - 2 * strokeWidth;\n    var x = _this2._get(cw, width, ops.x || 0, 'pos') + strokeWidth / 2,\n        y = _this2._get(ch, height, ops.y || 0, 'pos') + strokeWidth / 2;\n    _this2.ctx.lineWidth = strokeWidth;\n    _this2.ctx.fillStyle = fillColor;\n    _this2.ctx.strokeStyle = strokeColor;\n\n    _this2.ctx.beginPath();\n\n    _this2.ctx.strokeRect(x, y, width, height);\n\n    _this2.ctx.fillRect(x, y, width, height);\n\n    _this2.ctx.closePath();\n\n    _this2._resetCtx()._next();\n  });\n  return this;\n}; // 绘制圆形层；\n\n\nMCanvas.prototype.circle = function (ops) {\n  var _this3 = this;\n\n  this.queue.push(function () {\n    var _ops$fillColor2 = ops.fillColor,\n        fillColor = _ops$fillColor2 === void 0 ? '#fff' : _ops$fillColor2,\n        _ops$strokeColor2 = ops.strokeColor,\n        strokeColor = _ops$strokeColor2 === void 0 ? fillColor : _ops$strokeColor2,\n        _ops$strokeWidth2 = ops.strokeWidth,\n        strokeWidth = _ops$strokeWidth2 === void 0 ? 0 : _ops$strokeWidth2;\n    var cw = _this3.canvas.width,\n        ch = _this3.canvas.height;\n    var r = _this3._get(cw, 0, ops.r || 0, 'pos') - 2 * strokeWidth;\n    var x = _this3._get(cw, 2 * r, ops.x || 0, 'pos') + strokeWidth / 2 + r,\n        y = _this3._get(ch, 2 * r, ops.y || 0, 'pos') + strokeWidth / 2 + r;\n\n    _this3.ctx.beginPath();\n\n    _this3.ctx.arc(x, y, r, 0, Math.PI * 2, false);\n\n    _this3.ctx.fillStyle = fillColor;\n\n    _this3.ctx.fill();\n\n    _this3.ctx.strokeStyle = strokeColor;\n    _this3.ctx.lineWidth = strokeWidth;\n\n    _this3.ctx.stroke();\n\n    _this3.ctx.closePath();\n\n    _this3._resetCtx()._next();\n  });\n  return this;\n}; // 重置ctx属性;\n\n\nMCanvas.prototype._resetCtx = function () {\n  this.ctx.setTransform(1, 0, 0, 1, 0, 0);\n  this.ctx.restore();\n  return this;\n}; // 绘制水印；基于 add 函数封装；\n\n\nMCanvas.prototype.watermark = function () {\n  var image = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n  var ops = arguments.length > 1 ? arguments[1] : undefined;\n\n  if (!image) {\n    console.error('mcanvas error : there is not image of watermark.');\n    return;\n  } // 参数默认值；\n\n\n  var _ops$width = ops.width,\n      width = _ops$width === void 0 ? '40%' : _ops$width,\n      _ops$pos = ops.pos,\n      pos = _ops$pos === void 0 ? 'rightbottom' : _ops$pos,\n      _ops$margin = ops.margin,\n      margin = _ops$margin === void 0 ? 20 : _ops$margin;\n  var position = {\n    x: 0,\n    y: 0,\n    scale: 1,\n    rotate: 0\n  };\n\n  switch (pos) {\n    case 'leftTop':\n      position.x = \"left:\".concat(margin);\n      position.y = \"top:\".concat(margin);\n      break;\n\n    case 'leftBottom':\n      position.x = \"left:\".concat(margin);\n      position.y = \"bottom:\".concat(margin);\n      break;\n\n    case 'rightTop':\n      position.x = \"right:\".concat(margin);\n      position.y = \"top:\".concat(margin);\n      break;\n\n    case 'rightBottom':\n      position.x = \"right:\".concat(margin);\n      position.y = \"bottom:\".concat(margin);\n      break;\n\n    default:\n  }\n\n  this.add(image, {\n    width: width,\n    pos: position\n  });\n  return this;\n}; // 通用绘制图层函数；\n// 使用方式：\n// 多张图: add([{image:'',options:{}},{image:'',options:{}}]);\n// 单张图: add(image,options);\n\n\nMCanvas.prototype.add = function () {\n  var _this4 = this;\n\n  var image = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n  var options = arguments.length > 1 ? arguments[1] : undefined;\n  // 默认参数；\n  var def = {\n    width: '100%',\n    crop: {\n      x: 0,\n      y: 0,\n      width: '100%',\n      height: '100%'\n    },\n    pos: {\n      x: 0,\n      y: 0,\n      scale: 1,\n      rotate: 0\n    }\n  };\n  if (!_.isArr(image)) image = [{\n    image: image,\n    options: options\n  }];\n  image.forEach(function (v) {\n    // 将封装好的 add函数 推入队列中待执行；\n    // 参数经过 _handleOps 加工；\n    _this4.queue.push(function () {\n      _.getImage(v.image, function (img) {\n        _this4._add(img, _this4._handleOps(_.extend(def, v.options), img));\n      }, _this4.fn.error);\n    });\n  });\n  return this;\n};\n\nMCanvas.prototype._add = function (img, ops) {\n  if (ops.width === 0) console.warn(\"mcanvas warn: the width of mc-element is zero\");\n\n  var _$getSize2 = _.getSize(img),\n      iw = _$getSize2.iw,\n      ih = _$getSize2.ih; // let ratio = iw / ih;\n  // 画布canvas参数；\n\n\n  var cdx, cdy, cdw, cdh; // 素材canvas参数；\n\n  var _ops$crop = ops.crop,\n      lsx = _ops$crop.x,\n      lsy = _ops$crop.y,\n      lsw = _ops$crop.width,\n      lsh = _ops$crop.height;\n  var cratio = lsw / lsh;\n  var ldx, ldy, ldw, ldh; // 素材canvas的绘制;\n\n  var lcvs = document.createElement('canvas');\n  var lctx = lcvs.getContext('2d'); // 图片宽高比 * 1.4 是一个最安全的宽度，旋转任意角度都不会被裁剪；\n  // 没有旋转却长宽比很高大的图，会导致放大倍数太大，因此甚至了最高倍数为5；\n  // _ratio 为 较大边 / 较小边 的比例；\n\n  var _ratio = iw > ih ? iw / ih : ih / iw;\n\n  var lctxScale = _ratio * 1.4 > 5 ? 5 : _ratio * 1.4;\n  var spaceX, spaceY;\n  lcvs.width = Math.round(lsw * lctxScale);\n  lcvs.height = Math.round(lsh * lctxScale); // 限制canvas的大小，ios8以下为 2096, 其余平台均限制为 4096;\n\n  var shrink;\n\n  if (_.isIos8() && (lcvs.width > 2096 || lcvs.height > 2096)) {\n    if (cratio > 1) {\n      shrink = 2096 / lcvs.width;\n    } else {\n      shrink = 2096 / lcvs.height;\n    }\n  } else if (lcvs.width > 4096 || lcvs.height > 4096) {\n    if (cratio > 1) {\n      shrink = 4096 / lcvs.width;\n    } else {\n      shrink = 4096 / lcvs.height;\n    }\n  } // 从素材canvas的中心点开始绘制；\n\n\n  ldx = -Math.round(lsw / 2);\n  ldy = -Math.round(lsh / 2);\n  ldw = lsw;\n  ldh = Math.round(lsw / cratio); // 获取素材最终的宽高;\n\n  if (shrink) {\n    var _map = [lcvs.width, lcvs.height, ldx, ldy, ldw, ldh].map(function (v) {\n      return Math.round(v * shrink);\n    });\n\n    var _map2 = _slicedToArray(_map, 6);\n\n    lcvs.width = _map2[0];\n    lcvs.height = _map2[1];\n    ldx = _map2[2];\n    ldy = _map2[3];\n    ldw = _map2[4];\n    ldh = _map2[5];\n  }\n\n  lctx.translate(lcvs.width / 2, lcvs.height / 2);\n  lctx.rotate(ops.pos.rotate);\n  lctx.drawImage(img, lsx, lsy, lsw, lsh, ldx, ldy, ldw, ldh);\n  cdw = Math.round(ops.width * lctxScale);\n  cdh = Math.round(cdw / cratio);\n  spaceX = (lctxScale - 1) * ops.width / 2;\n  spaceY = spaceX / cratio; // 获取素材的位置；\n  //    配置的位置 - 缩放的影响 - 绘制成正方形的影响；\n\n  cdx = Math.round(ops.pos.x + cdw * (1 - ops.pos.scale) / 2 - spaceX);\n  cdy = Math.round(ops.pos.y + cdh * (1 - ops.pos.scale) / 2 - spaceY);\n  cdw *= ops.pos.scale;\n  cdh *= ops.pos.scale;\n  this.ctx.drawImage(lcvs, cdx, cdy, cdw, cdh);\n  lcvs = lctx = null;\n\n  this._next();\n}; // 参数加工函数；\n\n\nMCanvas.prototype._handleOps = function (ops, img) {\n  var cw = this.canvas.width,\n      ch = this.canvas.height;\n\n  var _$getSize3 = _.getSize(img),\n      iw = _$getSize3.iw,\n      ih = _$getSize3.ih; // 图片宽高比；\n\n\n  var ratio = iw / ih; // 根据参数计算后的绘制宽度；\n\n  var width = this._get(cw, iw, ops.width, 'pos'); // 裁剪的最大宽高；\n\n\n  var maxLsw, maxLsh; // 裁剪参数；\n\n  var _ops$crop2 = ops.crop,\n      cropx = _ops$crop2.x,\n      cropy = _ops$crop2.y,\n      cropw = _ops$crop2.width,\n      croph = _ops$crop2.height;\n  var crop = {};\n  crop.width = this._get(cw, iw, cropw, 'crop');\n  crop.height = this._get(ch, ih, croph, 'crop');\n  crop.x = this._get(iw, crop.width, cropx, 'crop');\n  crop.y = this._get(ih, crop.height, cropy, 'crop'); // 最大值判定；\n\n  if (crop.x > iw) crop.x = iw;\n  if (crop.y > ih) crop.y = ih;\n  maxLsw = iw - crop.x;\n  maxLsh = ih - crop.y;\n  if (crop.width > maxLsw) crop.width = maxLsw;\n  if (crop.height > maxLsh) crop.height = maxLsh; // 位置参数；\n\n  var _ops$pos2 = ops.pos,\n      px = _ops$pos2.x,\n      py = _ops$pos2.y,\n      pr = _ops$pos2.rotate,\n      ps = _ops$pos2.scale;\n  var pos = {\n    x: this._get(cw, width, px, 'pos'),\n    y: this._get(ch, width / ratio, py, 'pos'),\n    scale: ps,\n    rotate: parseFloat(pr) * Math.PI / 180\n  };\n  return {\n    width: width,\n    crop: crop,\n    pos: pos\n  };\n}; // --------------------------------------------------------\n// 绘制文字部分；\n// --------------------------------------------------------\n\n\nMCanvas.prototype.text = function () {\n  var _this5 = this;\n\n  var context = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : '';\n  var ops = arguments.length > 1 ? arguments[1] : undefined;\n  // 默认字体；\n  var fontFamily = \"helvetica neue,hiragino sans gb,Microsoft YaHei,arial,tahoma,sans-serif\"; // 默认的字体大小;\n\n  var size = this.canvas.width / 20;\n  this.queue.push(function () {\n    var defaultStyle = {\n      color: '#000',\n      type: 'fill',\n      // strokeText or fillText,\n      lineWidth: 1,\n      shadow: {\n        color: null,\n        blur: 0,\n        offsetX: 0,\n        offsetY: 0\n      }\n    };\n    var option = {\n      width: 300,\n      align: 'left',\n      smallStyle: _objectSpread({\n        font: \"\".concat(size * 0.8, \"px \").concat(fontFamily),\n        lineHeight: size * 0.9\n      }, _.deepCopy(defaultStyle)),\n      normalStyle: _objectSpread({\n        font: \"\".concat(size, \"px \").concat(fontFamily),\n        lineHeight: size * 1.1,\n        type: 'fill'\n      }, _.deepCopy(defaultStyle)),\n      largeStyle: _objectSpread({\n        font: \"\".concat(size * 1.3, \"px \").concat(fontFamily),\n        lineHeight: size * 1.4\n      }, _.deepCopy(defaultStyle)),\n      pos: {\n        x: 0,\n        y: 0,\n        rotate: 0\n      }\n    };\n    option = _.extend(option, ops); // 解析字符串模板后，调用字体绘制函数；\n\n    var parseContext = _this5._parse(context);\n\n    var max = 0,\n        maxFont;\n    parseContext.map(function (v) {\n      if (v.size > max) {\n        max = v.size;\n        maxFont = v.type;\n      }\n    }); // 当设置的宽度小于字体宽度时，强行将设置宽度设为与字体一致；\n\n    var maxFontSize = parseInt(option[\"\".concat(maxFont, \"Style\")].font);\n    if (maxFontSize && option.width < maxFontSize) option.width = maxFontSize;\n\n    _this5._text(parseContext, option);\n\n    _this5._resetCtx()._next();\n  });\n  return this;\n}; // 字符串模板解析函数\n// 解析 <s></s> <b></b>\n\n\nMCanvas.prototype._parse = function (context) {\n  var arr = context.split(/<s>|<b>/);\n  var result = [];\n\n  for (var i = 0; i < arr.length; i++) {\n    var value = arr[i];\n\n    if (/<\\/s>|<\\/b>/.test(value)) {\n      var splitTag = /<\\/s>/.test(value) ? '</s>' : '</b>',\n          type = /<\\/s>/.test(value) ? 'small' : 'large';\n      var tmp = arr[i].split(splitTag);\n      result.push({\n        type: type,\n        text: tmp[0],\n        // 用于字体的大小比较；\n        size: type === 'small' ? 0 : 2\n      });\n      tmp[1] && result.push({\n        type: 'normal',\n        text: tmp[1],\n        size: 1\n      });\n      continue;\n    }\n\n    arr[i] && result.push({\n      text: arr[i],\n      type: 'normal',\n      size: 1\n    });\n  }\n\n  return result;\n};\n\nMCanvas.prototype._text = function (textArr, option) {\n  var _this6 = this;\n\n  this.data.textId++;\n  this.data.text[this.data.textId] = {}; // 处理宽度参数；\n\n  option.width = this._get(this.canvas.width, 0, option.width, 'pos');\n\n  var style,\n      line = 1,\n      length = 0,\n      lineHeight = getLineHeight(textArr, option),\n      x = this._get(this.canvas.width, option.width, 0, 'pos'),\n      y = this._get(this.canvas.height, 0, 0, 'pos') + lineHeight; // data:字体数据；\n  // lineWidth:行宽；\n\n\n  this.data.text[this.data.textId][line] = {\n    data: [],\n    lineWidth: 0 // 生成字体数据；\n\n  };\n  textArr.forEach(function (v) {\n    style = option[\"\".concat(v.type, \"Style\")];\n    _this6.ctx.font = style.font;\n\n    var width = _this6.ctx.measureText(v.text).width; // 处理 <br> 换行，先替换成 '|',便于单字绘图时进行判断；\n\n\n    var context = v.text.replace(/<br>/g, '|'); // 先进行多字超出判断，超出宽度后再进行单字超出判断；\n\n    if (length + width > option.width || context.indexOf('|') !== -1) {\n      for (var i = 0, fontLength = context.length; i < fontLength; i++) {\n        var font = context[i];\n        width = _this6.ctx.measureText(font).width; // 当字体的计算宽度 > 设置的宽度 || 内容中包含换行时,进入换行逻辑；\n\n        if (length + width > option.width || font === '|') {\n          length = 0;\n          x = _this6._get(_this6.canvas.width, option.width, 0, 'pos');\n          y += lineHeight;\n          line += 1;\n          _this6.data.text[_this6.data.textId][line] = {\n            data: [],\n            lineWidth: 0\n          };\n          if (font === '|') continue;\n        }\n\n        _this6.data.text[_this6.data.textId][line]['data'].push({\n          context: font,\n          x: x,\n          y: y,\n          style: style,\n          width: width\n        });\n\n        length += width;\n        x += width;\n        _this6.data.text[_this6.data.textId][line]['lineWidth'] = length;\n      }\n    } else {\n      _this6.data.text[_this6.data.textId][line]['data'].push({\n        context: context,\n        x: x,\n        y: y,\n        style: style,\n        width: width\n      });\n\n      length += width;\n      x += width;\n      _this6.data.text[_this6.data.textId][line]['lineWidth'] = length;\n    }\n  }); // 创建文字画布；\n\n  var tcvs = document.createElement('canvas');\n  var tctx = tcvs.getContext('2d');\n\n  var tdx = this._get(this.canvas.width, option.width, option.pos.x, 'pos'),\n      tdy = this._get(this.canvas.height, 0, option.pos.y, 'pos');\n\n  var tdw, tdh;\n  tdw = tcvs.width = option.width;\n  tdh = tcvs.height = this._getTextRectHeight(line); // 通过字体数据进行文字的绘制；\n\n  _.forin(this.data.text[this.data.textId], function (k, v) {\n    // \b增加 align 的功能；\n    var add = 0;\n\n    if (v.lineWidth < option.width) {\n      if (option.align === 'center') {\n        add = (option.width - v.lineWidth) / 2;\n      } else if (option.align === 'right') {\n        add = option.width - v.lineWidth;\n      }\n    }\n\n    v.data.forEach(function (text) {\n      text.x += add;\n\n      _this6._fillText(tctx, text);\n    });\n  }); // tcvs.style.width = '300px';\n  // document.querySelector('body').appendChild(tcvs);\n  // 绘制文字画布；\n\n\n  var originX = tdx + tdw / 2,\n      originY = tdy + tdh / 2;\n  this.ctx.translate(originX, originY);\n  this.ctx.rotate(parseFloat(option.pos.rotate) * Math.PI / 180);\n  this.ctx.drawImage(tcvs, -tdw / 2, -tdh / 2, tdw, tdh); // 获取行高；\n\n  function getLineHeight(textArr, option) {\n    var lh = 0,\n        vlh;\n    textArr.forEach(function (v) {\n      vlh = option[\"\".concat(v.type, \"Style\")].lineHeight;\n      if (vlh > lh) lh = vlh;\n    });\n    return lh;\n  }\n};\n\nMCanvas.prototype._fillText = function (ctx, text) {\n  var context = text.context,\n      x = text.x,\n      y = text.y,\n      style = text.style;\n  var align = style.align,\n      lineWidth = style.lineWidth,\n      shadow = style.shadow;\n  var color = shadow.color,\n      blur = shadow.blur,\n      offsetX = shadow.offsetX,\n      offsetY = shadow.offsetY;\n  ctx.font = style.font;\n  ctx.textAlign = align;\n  ctx.textBaseline = 'alphabetic';\n  ctx.lineWidth = lineWidth;\n  ctx.shadowColor = color;\n  ctx.shadowBlur = blur;\n  ctx.shadowOffsetX = offsetX;\n  ctx.shadowOffsetY = offsetY;\n\n  if (style.gradient) {\n    var _style$gradient = style.gradient,\n        type = _style$gradient.type,\n        colorStop = _style$gradient.colorStop;\n    var x1, y1, x2, y2;\n\n    if (type === 1) {\n      x1 = x;\n      y1 = y;\n      x2 = x + text.width;\n      y2 = y;\n    } else {\n      x1 = x;\n      y1 = y - style.lineHeight;\n      x2 = x;\n      y2 = y;\n    }\n\n    var grad = ctx.createLinearGradient(x1, y1, x2, y2);\n    var colorNum = colorStop.length || 0;\n\n    _.forin(colorStop, function (i, v) {\n      grad.addColorStop(1 / colorNum * (+i + 1), v);\n    });\n\n    ctx[\"\".concat(style.type, \"Style\")] = grad;\n  } else {\n    ctx[\"\".concat(style.type, \"Style\")] = style.color;\n  }\n\n  ctx[\"\".concat(style.type, \"Text\")](context, x, y);\n\n  this._resetCtx();\n};\n\nMCanvas.prototype._getTextRectHeight = function (lastLine) {\n  var lastLineData = this.data.text[this.data.textId][lastLine].data[0];\n  return lastLineData.y + lastLineData.style.lineHeight;\n}; // --------------------------------------------------------\n// 业务功能函数部分\n// --------------------------------------------------------\n// 参数加工函数；\n// 兼容 5 种 value 值：\n// x:250, x:'250px', x:'100%', x:'left:250',x:'center',\n// width:100,width:'100px',width:'100%'\n\n\nMCanvas.prototype._get = function (par, child, str, type) {\n  var result = str;\n\n  if (typeof str === 'string') {\n    if (str.indexOf(':') !== -1 && type === 'pos') {\n      var arr = str.split(':');\n\n      switch (arr[0]) {\n        case 'left':\n        case 'top':\n          result = +arr[1].replace('px', '');\n          break;\n\n        case 'right':\n        case 'bottom':\n          result = par - +arr[1].replace('px', '') - child;\n          break;\n\n        default:\n      }\n    } else if (str.indexOf('px') !== -1) {\n      result = +str.replace('px', '');\n    } else if (str.indexOf('%') !== -1) {\n      if (type === 'crop') {\n        result = child * +str.replace('%', '') / 100;\n      } else {\n        result = par * +str.replace('%', '') / 100;\n      }\n    } else if (str === 'center') {\n      result = (par - child) / 2;\n    } else if (str === 'origin') {\n      result = child;\n    } else {\n      result = +str;\n    }\n  }\n\n  return Math.round(result);\n}; // 绘制函数；\n\n\nMCanvas.prototype.draw = function (ops) {\n  var _this7 = this;\n\n  var _ops = {\n    type: 'jpeg',\n    quality: .9,\n    success: function success() {},\n    error: function error() {}\n  },\n      b64;\n\n  if (typeof ops === 'function') {\n    _ops.success = ops;\n  } else {\n    _ops = _.extend(_ops, ops);\n    if (_ops.type === 'jpg') _ops.type = 'jpeg';\n  }\n\n  this.fn.error = _ops.error;\n\n  this.fn.success = function () {\n    setTimeout(function () {\n      b64 = _this7.canvas.toDataURL(\"image/\".concat(_ops.type), _ops.quality);\n\n      _ops.success(b64);\n    }, 0);\n  };\n\n  this._next();\n\n  return this;\n};\n\nMCanvas.prototype._next = function () {\n  if (this.queue.length > 0) {\n    this.queue.shift()();\n  } else {\n    this.fn.success();\n  }\n};\n\nMCanvas.prototype.clear = function () {\n  this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n  return this;\n};\n\nvar getPos = function getPos(imgW, cropW, str) {\n  if (!str && str !== 0) return str;\n  var result = str;\n\n  if (typeof str === 'string') {\n    if (str.indexOf(':') !== -1) {\n      var arr = str.split(':');\n\n      switch (arr[0]) {\n        case 'left':\n        case 'top':\n          result = +arr[1].replace('px', '');\n          break;\n\n        case 'right':\n        case 'bottom':\n          result = imgW - +arr[1].replace('px', '');\n          break;\n\n        default:\n      }\n    } else if (str.indexOf('px') !== -1) {\n      result = +str.replace('px', '');\n    } else if (str.indexOf('%') !== -1) {\n      result = imgW * +str.replace('%', '') / 100;\n    } else if (str === 'center') {\n      result = (imgW - cropW) / 2;\n    } else {\n      result = +str;\n    }\n  }\n\n  return Math.round(result);\n}; // 获取长度\n\n\nvar getLength = function getLength(imgW, str) {\n  if (!str && str !== 0) return str;\n  var result = str;\n\n  if (typeof str === 'string') {\n    if (str.indexOf('px') !== -1) {\n      result = +str.replace('px', '');\n    } else if (str.indexOf('%') !== -1) {\n      result = imgW * +str.replace('%', '') / 100;\n    } else if (str === 'center') {\n      result = imgW / 2;\n    } else {\n      result = +str;\n    }\n  }\n\n  return Math.round(result);\n}; // interface ops {\n//     type: 'rect' | 'circle' | 'triangle'\n//  左上角坐标\n//     x: number | string \n//     y: number | string\n//  type = 'rect' 时有效\n//     width?: number | string\n//     height?: number | string\n//  type = 'circle' 时有效   \n//     r?: number | string\n//     exportConfig?: {\n//         type: 'jpg' | 'png' | 'jpeg'\n//         quality: number (0 - 1)\n//     }\n// }\n\n\nfunction MCrop(image) {\n  var ops = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n  if (!image) {\n    console.error('mcrop error : there is not a image.');\n    return;\n  }\n\n  var _ops$success = ops.success,\n      success = _ops$success === void 0 ? function () {} : _ops$success,\n      _ops$error = ops.error,\n      error = _ops$error === void 0 ? function () {} : _ops$error;\n\n  _.getImage(image, function (img) {\n    var _$getSize = _.getSize(img),\n        iw = _$getSize.iw,\n        ih = _$getSize.ih;\n\n    var minL = Math.min(iw, ih);\n    var _ops$type = ops.type,\n        type = _ops$type === void 0 ? 'rect' : _ops$type;\n    var cvs = document.createElement('canvas');\n    var ctx = cvs.getContext('2d');\n\n    if (type === 'rect') {\n      var width = getLength(iw, ops.width) || iw;\n      var height = getLength(ih, ops.height) || ih;\n      if (width > iw) width = iw;\n      if (height > ih) height = ih;\n      var x = getPos(iw, width, ops.x);\n      var y = getPos(ih, height, ops.y); // 扣除超出部分，避免截图出现空白\n\n      if (x + width > iw) width = iw - x;\n      if (y + height > ih) height = ih - y;\n      cvs.width = width;\n      cvs.height = height;\n      ctx.drawImage(img, -x, -y, iw, ih);\n    } else if (type === 'circle') {\n      var r = getLength(minL, ops.r) || minL / 2;\n      if (r * 2 > minL) r = minL / 2;\n\n      var _x = getPos(iw, r * 2, ops.x);\n\n      var _y = getPos(ih, r * 2, ops.y);\n\n      cvs.width = r * 2;\n      cvs.height = r * 2;\n      ctx.beginPath();\n      ctx.arc(r, r, r, 0, Math.PI * 2, false);\n      ctx.fillStyle = '#fff';\n      ctx.fill();\n      ctx.globalCompositeOperation = 'source-in';\n      ctx.drawImage(img, -_x, -_y, iw, ih);\n    }\n\n    setTimeout(function () {\n      var exportConfig = _.extend({\n        type: 'jpeg',\n        quality: .9\n      }, ops.exportConfig || {});\n\n      if (type === 'circle') {\n        exportConfig.type = 'png';\n      }\n\n      var b64 = cvs.toDataURL(\"image/\".concat(exportConfig.type), exportConfig.quality);\n      success(b64);\n    }, 0);\n  }, function (err) {\n    console.error('mcrop error: load image error.', err);\n    error(err);\n  });\n}\n\nvar MCrop$1 = MCrop;\n\nexport default MCanvas;\nexport { MCrop$1 as MCrop };\n//# sourceMappingURL=mcanvas.es.js.map\n"],"sourceRoot":""}